<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lavastida · Micropanadería Artesanal</title>

  <!-- Tipografía secundaria -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&display=swap" rel="stylesheet"/>

  <style> /* CSS */
    :root{
      --rojo:#8F1C13;
      --moka:#513933;
      --hueso:#E8E3DD;
      --blanco:#FFFFFF;
      --borde: color-mix(in oklab, var(--moka) 22%, var(--hueso));
      --sombra-sm: 0 4px 16px rgba(0,0,0,.06);
      --sombra-md: 0 10px 30px rgba(0,0,0,.08);
      --radio:16px;
      --verde-wa:#25D366;
    }

    /* Fuente de marca */
    @font-face{
  font-family:"Pricedown Black";
  src: url("Pricedown-Black.otf") format("opentype"),
       url("pricedown bl.otf") format("opentype");
  font-weight:900; 
  font-style:normal; 
  font-display:swap;
}

    *{box-sizing:border-box}
    html,body{margin:0}

    /* Fondo con patrón (patron-fondo.jpeg) */
    body{
      font-family:"Lexend", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--moka);
      background-color: var(--hueso);
      background-image:
        linear-gradient(rgba(255,255,255,.9), rgba(255,255,255,.9)),
        url("patron-fondo.jpeg");
      background-repeat: repeat;
      background-size: 280px auto;
      background-attachment: fixed;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    .wrap{max-width:1160px; margin:auto; padding:0 16px}

    /* ===== Top App Bar ===== */
    .appbar{
      position:sticky; top:0; z-index:20; background:var(--blanco);
      border-bottom:4px solid var(--rojo);
    }
    .appbar .row{
      display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
      padding:10px 12px;
    }
    .brand{display:flex; align-items:center; gap:10px}
    .brand img{height:40px; width:auto; object-fit:contain; border-radius:8px}
    .brand-title{
      margin:0; line-height:1;
      font-family:"Pricedown Black","Lexend",sans-serif;
      font-size:26px; color:var(--rojo);
    }
    .brand-sub{font-size:12px; opacity:.9; margin-top:2px}

    .search{
      display:flex; align-items:center; gap:10px; background:#fff;
      border:1px solid var(--borde); border-radius:999px; padding:8px 12px;
      box-shadow: var(--sombra-sm);
    }
    .search svg{width:18px; height:18px; opacity:.6}
    #q{border:0; outline:0; flex:1; font-size:14px; background:transparent}

    .actions{display:flex; gap:10px; align-items:center}

    /* Botón carrito en appbar */
    .cart-btn{
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      gap:8px; padding:8px 12px; border:1px solid var(--borde); border-radius:999px;
      background:#fff; cursor:pointer; font-weight:800;
      box-shadow:var(--sombra-sm);
    }
    .cart-btn svg{width:20px; height:20px}
    .cart-badge{
      position:absolute; top:-8px; right:-8px; background:var(--rojo); color:#fff;
      border-radius:999px; font-size:12px; font-weight:900; padding:2px 7px; line-height:1;
      min-width:22px; text-align:center;
    }

    /* ===== Filtros ===== */
    .filters{display:flex; gap:10px; flex-wrap:wrap; padding:12px 0}
    .filters button{
      border:1px solid var(--borde); background:#fff; color:var(--moka);
      padding:8px 12px; border-radius:999px; font-weight:800; cursor:pointer;
      box-shadow:var(--sombra-sm);
    }
    .filters button.active{background:var(--rojo); color:#fff; border-color:var(--rojo)}

    /* ===== Grid de productos ===== */
    .grid{
      display:grid; gap:18px; padding-bottom:28px;
      grid-template-columns:repeat(auto-fill, minmax(240px, 1fr));
    }
    .card{
      background:#fff; border:1px solid var(--borde); border-radius:var(--radio); overflow:hidden;
      display:flex; flex-direction:column; box-shadow:var(--sombra-md); transition:.25s transform ease;
    }
    .card:hover{transform:translateY(-3px)}

    /* Imágenes SIN recorte (contain) */
    .thumb{
      aspect-ratio:4/3;
      background:color-mix(in oklab, var(--rojo) 12%, var(--hueso));
      display:flex; align-items:center; justify-content:center; overflow:hidden;
    }
    .thumb img{
      max-width:100%; max-height:100%;
      object-fit:contain; display:block;
    }

    .body{padding:14px 14px 8px}
    .title{margin:0; font-size:18px; font-weight:800; color:var(--moka)}
    .badge{display:inline-block; margin-top:6px; font-size:12px; font-weight:700; color:var(--rojo)}
    .price{margin-top:8px; font-weight:900; color:var(--rojo); font-size:16px}
    .cta{display:flex; gap:10px; padding:12px 14px 16px}
    .btn{
      flex:1; text-decoration:none; text-align:center; border-radius:10px; padding:10px 12px;
      font-weight:800; border:1px solid var(--rojo); color:var(--rojo); background:#fff;
      cursor:pointer;
    }
    .btn.fill{background:var(--rojo); color:#fff}

    /* ===== Drawer Carrito ===== */
    .drawer{position:fixed; inset:0; display:none; z-index:50}
    .drawer.open{display:block}
    .drawer .backdrop{position:absolute; inset:0; background:rgba(0,0,0,.35)}
    .drawer .panel{
      position:absolute; right:0; top:0; height:100%; width:min(420px, 100%);
      background:#fff; display:flex; flex-direction:column; box-shadow:-20px 0 40px rgba(0,0,0,.2);
      border-left:3px solid var(--rojo);
    }
    /* botón cerrar dentro del carrito */
.close-btn {
  background: none;
  border: none;
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
  color: var(--moka);
}
.close-btn:hover { color: var(--rojo); }
    .panel header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px; border-bottom:1px solid var(--borde)}
    .panel h3{margin:0; font-size:18px}
    .cart-list{flex:1; overflow:auto; padding:12px}
    .item{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; border:1px solid var(--borde); border-radius:12px; padding:10px; margin-bottom:10px}
    .item h4{margin:0 0 4px 0; font-size:15px}
    .muted{font-size:12px; color:#777}
    .qty{display:flex; align-items:center; gap:8px}
    .qty button{width:28px; height:28px; border-radius:6px; border:1px solid var(--borde); background:#fff; font-weight:900; cursor:pointer}
    .item .remove{border:0; background:transparent; color:#888; cursor:pointer}
    .panel footer{border-top:1px solid var(--borde); padding:14px; display:grid; gap:10px}
    .total{display:flex; justify-content:space-between; font-weight:900}
    .wa{display:inline-flex; align-items:center; justify-content:center; gap:8px; background:var(--verde-wa); color:#fff; border:0; padding:12px; border-radius:10px; font-weight:800; text-decoration:none; text-align:center}
    .wa svg{width:18px; height:18px}
    .wa a {
  color: #fff;              /* texto blanco */
  text-decoration: none;    /* quita el subrayado */
  font-weight: 700;         /* más vistoso */
}

.wa a:hover {
  color: #fff;              /* sigue blanco al pasar el mouse */
  text-decoration: none;    /* evita que reaparezca el subrayado */
}
    /* Botón de WhatsApp en el carrito */
    .cart-footer .wa {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 14px;
    background: #25D366; /* verde oficial WhatsApp */
    border-radius: 8px;
    text-decoration: none;  /* quita el subrayado */
    font-weight: bold;
    font-size: 16px;
    color: #fff;           /* texto blanco */
    transition: background 0.2s ease;
    }
    .cart-footer .wa:hover {
    background: #20b358;   /* tono más oscuro al pasar el mouse */
    }

    /* Footer */
    footer{background:#fff; border-top:4px solid var(--rojo)}
    .foot{display:grid; grid-template-columns:1fr auto; gap:16px; align-items:center; padding:16px}
    .foot small{opacity:.9}
    .social{display:flex; gap:14px}
    .social a svg{width:22px; height:22px; fill:var(--moka)}
    .social a:hover svg{fill:var(--rojo)}
    .copy{text-align:center; font-size:12px; padding:10px; border-top:1px dashed #eee}

    @media (max-width:720px){
      .foot{grid-template-columns:1fr}
      .brand img{height:34px}
      .brand-title{font-size:22px}
      .drawer .panel{width:100%}
    }
    
       /* responsiveness */
       /* Botón carrito ya en tu HTML: solo afinamos tamaños en móvil */
.appbar .row{ overflow: visible; } /* que no recorte el badge */



.cart-btn{
  position: relative;
  width: 44px; height: 44px; border-radius: 50%;
  display: grid; place-items: center;
  background: #fff; border: 1px solid var(--borde);
  box-shadow: var(--sombra); cursor: pointer;
}
.cart-btn svg{ width: 22px; height: 22px; fill: var(--moka); }
.cart-badge{
  position: absolute; top: -6px; right: -6px;
  background: var(--rojo); color: #fff; font-weight: 800;
  font-size: 12px; line-height: 1; padding: 3px 6px; border-radius: 999px;
}

/* En pantallas pequeñas, todo un pelín más compacto */
@media (max-width:480px){
  /* Fila: logo | buscador | carrito (3 columnas) */
  .appbar .row{
    display:grid;
    grid-template-columns: min-content 1fr min-content; /* logo - buscador elástico - carrito fijo */
    gap:8px;
    align-items:center;
  }

  /* El buscador no debe forzar ancho */
  .search{ min-width:0; }
  #q{ width:100%; min-width:0; }

  /* Botón carrito compacto y visible */
  .actions{ display:flex; justify-content:flex-end; min-width:auto; }
  .cart-btn{ width:40px; height:40px; flex:0 0 40px; }
  .cart-btn svg{ width:20px; height:20px; }

  /* Globito de cantidad, que no se salga */
  .cart-badge{ top:2px; right:2px; }
} .wrap{ padding-left:12px; padding-right:12px; }
.grid{ overflow:hidden; }
.thumb img{ max-width:100%; height:auto; }
  </style>
</head>
<body> <!-- ===== HTML ===== -->

  <!-- ===== TOP BAR ===== -->
  <div class="appbar">
    <div class="wrap row">
      <div class="brand">
        <img src="lavastida_logo.jpeg" alt="Lavastida" />
        <div>
          <h1 class="brand-title">LAVASTIDA</h1>
          <div class="brand-sub">Micropanadería Artesanal</div>
        </div>
      </div>

      <label class="search" aria-label="Buscar">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15.5 14h-.8l-.3-.3A6.5 6.5 0 1014 15.5l.3.3v.8L20 21.5 21.5 20l-6-6zM10.5 15A4.5 4.5 0 1115 10.5 4.5 4.5 0 0110.5 15z"/></svg>
        <input id="q" type="search" placeholder="Buscar productos…" />
      </label>

      <div class="actions">
        <!-- Botón Carrito -->
        <button class="cart-btn" id="openCart" type="button" title="Ver carrito">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M7 4h-.8a1 1 0 1 1 0-2H7a1 1 0 0 1 .96.73L8.3 4H21a1 1 0 0 1 .96 1.27l-2 7A1 1 0 0 1 19 13H9a1 1 0 0 1-1-.76L6.2 5.2 5.8 4H3a1 1 0 1 1 0-2h3a1 1 0 0 1 .96.73L8.3 4H7Zm2.4 11a1.6 1.6 0 1 1 0 3.2 1.6 1.6 0 0 1 0-3.2Zm8 0a1.6 1.6 0 1 1 0 3.2 1.6 1.6 0 0 1 0-3.2Z"/>
          </svg>
          <span class="cart-badge" id="cartCount">0</span>
        </button>
      </div>
      <div class="drawer" id="drawer" aria-hidden="true">
        <div class="backdrop"></div>
        <div class="panel">
          <header>
            <h3>Tu pedido</h3>
            <button id="closeCart" class="close-btn" aria-label="Cerrar carrito">×</button>
          </header>
          <div class="cart-list" id="cartList"></div>
          <div class="total">
            <span>Total</span>
            <span id="cartTotal">CUP 0</span>
          </div>
          <div class="wa">
            <a id="sendWA" href="#" target="_blank">Enviar por WhatsApp</a>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- ===== CATÁLOGO ===== -->
  <main class="wrap" style="padding:12px 0 4px">
    <div class="filters" id="filtros">
      <button class="active" data-filter="todas">Todas</button>
      <button data-filter="pan">Panes</button>
      <button data-filter="dulce">Dulces</button>
      <button data-filter="especial">Especiales</button>
    </div>

    <!-- contenedor del grid -->
    <div id="grid" class="grid"></div>

    <p style="margin:6px 0 18px;opacity:.75;font-size:13px">* Precios en CUP; orientativos según peso/harina disponible.</p>
  </main>

  <!-- ===== DRAWER: Carrito ===== -->
  <div class="drawer" id="drawer" aria-hidden="true">
    <div class="backdrop" id="closeCart" tabindex="-1" aria-label="Cerrar carrito"></div>
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <header>
        <h3 id="cartTitle">Tu pedido</h3>
        <button id="closeCart" aria-label="Cerrar carrito">✖</button>
        <button class="btn" id="clearCart" type="button">Vaciar</button>
      </header>
      <div class="cart-list" id="cartList"></div>
      <footer>
        <div class="total"><span>Total</span><span id="cartTotal">CUP 0</span></div>
        <a class="wa" id="sendWA" href="#" target="_blank" rel="noopener" aria-label="Enviar por WhatsApp">
          <!-- Icono WhatsApp -->
          <svg viewBox="0 0 24 24" fill="#fff"><path d="M20.5 3.5A11.8 11.8 0 0012 0 12 12 0 001 18.4L0 24l5.7-1.5A12 12 0 1020.5 3.5zM12 21a9 9 0 01-4.6-1.2l-.3-.2-3.4.9.9-3.3-.2-.3A9 9 0 1121 12a9 9 0 01-9 9z"/></svg>
          Enviar por WhatsApp
        </a>
      </footer>
    </div>
  </div>

  <!-- ===== FOOTER ===== -->
  <footer>
    <div class="wrap foot">
      <small><strong>Horario & Encargos:</strong> Lun–Mié-Jue–Vie, 9:00–19:00 (encargos con 1 día de antelación).<br>
      Dirección: 5ta A #6211, e/62 y 64, La Habana, Playa, Miramar.</small>

      <div class="social" aria-label="Redes sociales">
        <!-- Instagram -->
        <a href="https://instagram.com/panaderia_lavastida" target="_blank" title="Instagram" aria-label="Instagram">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5zm10 2H7a3 3 0 00-3 3v10a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3zm-5 3.5A5.5 5.5 0 1112 17a5.5 5.5 0 010-11zm0 2A3.5 3.5 0 1015.5 12 3.5 3.5 0 0012 7.5zm4.8-2.3a1.3 1.3 0 11-2.6 0 1.3 1.3 0 012.6 0z"/></svg>
        </a>
        <!-- Facebook -->
        <a href="https://www.facebook.com/share/19KFP6AqJJ/?mibextid=wwXIfr" target="_blank" title="Facebook" aria-label="Facebook">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 10-11.6 9.9v-7h-2v-3h2v-2.3c0-2 1.2-3.2 3-3.2.9 0 1.8.2 1.8.2v2h-1c-1 0-1.4.6-1.4 1.3V12h2.5l-.4 3h-2v7A10 10 0 0022 12z"/></svg>
        </a>
        <!-- WhatsApp directo -->
        <a href="https://wa.me/5355427887" target="_blank" title="WhatsApp" aria-label="WhatsApp">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.5 3.5A11.8 11.8 0 0012 0 12 12 0 001 18.4L0 24l5.7-1.5A12 12 0 1020.5 3.5z"/></svg>
        </a>
      </div>
    </div>
    <div class="copy">© <span id="y"></span> Annette Lavastida</div>
  </footer>

  <!-- ===== JAVASCRIPT: catálogo + búsqueda + filtros + carrito (con memoria) ===== -->
  <script>
    // Catálogo
    const catalogo = [
      // Especiales
      { nombre:'Bagel con toppings',        precio:'CUP 400',  categoria:'especial', img:'bagel-toppings.jpeg' },
      { nombre:'Bagel plain',               precio:'CUP 350',  categoria:'especial', img:'bagel-plain.jpeg' },

      // Dulces
      { nombre:'Babka (chocolate o canela)',  precio:'CUP 1,500', categoria:'dulce',   img:'babka.jpeg' },
      { nombre:'Cinnamon Roll',             precio:'CUP 360',   categoria:'dulce',   img:'cinnamon.jpeg' },

      // Panes
      { nombre:'Baguette 150g',             precio:'CUP 250', categoria:'pan', img:'baguette150.jpeg' },
      { nombre:'Baguette 300g',             precio:'CUP 500', categoria:'pan', img:'baguette300.jpeg' },
      { nombre:'Baguette 500g',             precio:'CUP 700', categoria:'pan', img:'baguette500.jpeg' },
      { nombre:'Bun Brioche 50g',           precio:'CUP 100', categoria:'pan', img:'brioche50.jpeg' },
      { nombre:'Bun Brioche 90g',           precio:'CUP 200', categoria:'pan', img:'brioche90.jpeg' },
      { nombre:'Bun Brioche 120g',          precio:'CUP 280', categoria:'pan', img:'brioche120.jpeg' },
      { nombre:'Challah 400g',              precio:'CUP 750', categoria:'pan', img:'challah400.jpeg' },
      { nombre:'Challah 500g',              precio:'CUP 800', categoria:'pan', img:'challah500.jpeg' },
      { nombre:'Challah 600g',              precio:'CUP 1,100', categoria:'pan', img:'challah600.jpeg' },
      { nombre:'Ciabatta 150g',             precio:'CUP 200', categoria:'pan', img:'ciabatta150.jpeg' },
      { nombre:'Ciabatta 300g',             precio:'CUP 450', categoria:'pan', img:'ciabatta300.jpeg' },
      { nombre:'Focaccia 400g',             precio:'CUP 480', categoria:'pan', img:'focaccia400.jpeg' },
      { nombre:'Hogaza rústica 300g',       precio:'CUP 400', categoria:'pan', img:'hogaza300.jpeg' },
      { nombre:'Hogaza rústica 500g',       precio:'CUP 700', categoria:'pan', img:'hogaza500.jpeg' },
      { nombre:'Hogaza rústica 800g',       precio:'CUP 1,000', categoria:'pan', img:'hogaza800.jpeg' },
      { nombre:'Molde Brioche',             precio:'CUP 700', categoria:'pan', img:'moldebrioche.jpeg' },
    ];

    // Orden alfabético (español + números)
    const productos = catalogo.slice().sort((a,b)=> a.nombre.localeCompare(b.nombre,'es',{numeric:true,sensitivity:'base'}));

    // Elementos UI
    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const filtros = document.querySelectorAll('#filtros button');

    // === Carrito (estado + persistencia) ===
    const CART_KEY = 'lavastida_cart_v1';
    const cart = new Map(); // key: nombre -> { producto, qty }

    const drawer   = document.getElementById('drawer');
    const openCart = document.getElementById('openCart');
    const closeCart= document.getElementById('closeCart');
    const cartList = document.getElementById('cartList');
    const cartTotal= document.getElementById('cartTotal');
    const cartCount= document.getElementById('cartCount');
    const clearCart= document.getElementById('clearCart');
    const sendWA   = document.getElementById('sendWA');

    const priceToNumber = p => Number(p.replace(/[^\d]/g,''));
    const fmt = n => 'CUP ' + n.toLocaleString('es-ES');

    // Botón cerrar carrito
    closeCart.addEventListener('click', () => {
    drawer.classList.remove('open');
    drawer.setAttribute('aria-hidden','true');
    });

    // También cerrar con tecla Escape
    document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
    drawer.classList.remove('open');
    drawer.setAttribute('aria-hidden','true');
     }
    });  

    // ====== Persistencia ======
    function saveCart(){
      const plain = [...cart.values()].map(({producto,qty})=>({
        nombre: producto.nombre,
        precio: producto.precio,
        categoria: producto.categoria,
        img: producto.img || '',
        qty
      }));
      localStorage.setItem(CART_KEY, JSON.stringify(plain));
    }
    function loadCart(){
      try{
        const raw = localStorage.getItem(CART_KEY);
        if(!raw) return;
        const arr = JSON.parse(raw);
        arr.forEach(entry=>{
          const p = { nombre:entry.nombre, precio:entry.precio, categoria:entry.categoria, img:entry.img };
          cart.set(p.nombre, { producto:p, qty:Number(entry.qty)||0 });
        });
      }catch(e){ console.warn('No se pudo cargar el carrito guardado:', e); }
    }

    // === Lógica de carrito ===
    function add(p){
      const key = p.nombre;
      const item = cart.get(key) || { producto: p, qty: 0 };
      item.qty++;
      cart.set(key, item);
      syncCart();
    }
    function inc(name){ const it = cart.get(name); if(!it) return; it.qty++; syncCart(); }
    function dec(name){ const it = cart.get(name); if(!it) return; it.qty--; if(it.qty<=0) cart.delete(name); syncCart(); }
    function delItem(name){ cart.delete(name); syncCart(); }
    function empty(){ cart.clear(); syncCart(); }

    function totalQty(){ let t=0; cart.forEach(i=>t+=i.qty); return t; }
    function totalCUP(){ let t=0; cart.forEach(i=> t += priceToNumber(i.producto.precio) * i.qty ); return t; }

    function buildMessage(){
      if(cart.size===0) return "Hola Lavastida, quiero consultar disponibilidad.";
      const lines = ["Hola Lavastida, quiero este pedido:", ""];
      cart.forEach(({producto,qty})=>{
        lines.push(`- ${producto.nombre} × ${qty} — ${producto.precio}`);
      });
      lines.push("", `Total: ${fmt(totalCUP())}`, "", "¿Disponibilidad y tiempo de entrega?");
      return lines.join("\n");
    }

    function syncCart(){
      // contador en botón
      cartCount.textContent = totalQty();

      // lista del drawer
      cartList.innerHTML = [...cart.values()].map(({producto,qty})=>`
        <div class="item">
          <div>
            <h4>${producto.nombre}</h4>
            <div class="muted">${producto.precio} · ${producto.categoria}</div>
          </div>
          <div class="qty">
            <button onclick="DEC('${producto.nombre.replace(/'/g,"\\'")}')">−</button>
            <strong>${qty}</strong>
            <button onclick="INC('${producto.nombre.replace(/'/g,"\\'")}')">+</button>
            <button class="remove" title="Eliminar" onclick="DEL('${producto.nombre.replace(/'/g,"\\'")}')">✕</button>
          </div>
        </div>
      `).join('') || '<p style="opacity:.7">Tu carrito está vacío.</p>';

      // total
      cartTotal.textContent = fmt(totalCUP());

      // WhatsApp
      const mensaje = encodeURIComponent(buildMessage());
      sendWA.href = `https://wa.me/5355427887?text=${mensaje}`;

      // guardar
      saveCart();
    }

    // Exponer funciones para los botones del drawer
    window.INC = inc; window.DEC = dec; window.DEL = delItem;

    // === UI de catálogo ===
    function card(p){
      const imgTag = p.img ? `<img src="${p.img}" alt="${p.nombre}" onerror="this.style.display='none'">` : '';
      return `
        <article class="card" data-cat="${p.categoria}">
          <div class="thumb">${imgTag}</div>
          <div class="body">
            <h3 class="title">${p.nombre}</h3>
            <span class="badge">${p.categoria}</span>
            <div class="price">${p.precio}</div>
          </div>
          <div class="cta">
            <button class="btn fill" onclick='add(${JSON.stringify(p)})'>Añadir</button>
          </div>
        </article>`;
    }

    function render(filtro='todas', texto=''){
      const term = texto.trim().toLowerCase();
      grid.innerHTML = productos
        .filter(p => filtro==='todas' ? true : p.categoria===filtro)
        .filter(p => term ? p.nombre.toLowerCase().includes(term) : true)
        .map(card).join('');
    }

    // Filtros
    filtros.forEach(b=>{
      b.addEventListener('click', ()=>{
        filtros.forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        render(b.dataset.filter, q.value);
      });
    });

    // Búsqueda
    q.addEventListener('input', ()=>{
      const activo = document.querySelector('#filtros .active')?.dataset.filter || 'todas';
      render(activo, q.value);
    });

    // Drawer events
    openCart.addEventListener('click', ()=> { drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); });
    closeCart.addEventListener('click', ()=> { drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); });
    clearCart.addEventListener('click', empty);

    // Inicio
    render();
    loadCart();   // <-- carga desde localStorage
    syncCart();   // <-- pinta UI y guarda el estado normalizado
    document.getElementById('y').textContent = new Date().getFullYear();
    
  </script>
</body>
</html>